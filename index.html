<!DOCTYPE html>
<html lang="ko">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
Â  Â  <title>ë¹„ìƒëŒ€í”¼ ì¸ì› ë³´ê³ </title>
Â  Â  <style>
Â  Â  Â  Â  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; background: #f0f2f5; color: #333; }
Â  Â  Â  Â  h2 { text-align: center; margin: 1.5rem 0; color: #1a237e; }
Â  Â  Â  Â  .form-container { display: flex; flex-direction: column; gap: 15px; max-width: 480px; margin: 20px auto; padding: 20px; background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
Â  Â  Â  Â  label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.95rem; color: #444; }
Â  Â  Â  Â  input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; box-sizing: border-box; transition: border-color 0.3s; }
Â  Â  Â  Â  input:focus, select:focus, textarea:focus { border-color: #007bff; outline: none; box-shadow: 0 0 0 3px rgba(0,123,255,0.25); }
Â  Â  Â  Â  textarea { resize: vertical; min-height: 80px; }
Â  Â  Â  Â  button { width: 100%; padding: 12px; background: #007bff; color: #fff; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: background-color 0.3s, transform 0.1s; margin-top: 10px; }
Â  Â  Â  Â  button:hover { background: #0056b3; }
Â  Â  Â  Â  button:active { transform: scale(0.99); }
Â  Â  Â  Â  .note-tip { font-size: 0.85rem; color: #777; margin-top: 5px; text-align: right; }
Â  Â  Â  Â  .checkbox-group { display: flex; align-items: center; gap: 10px; }
Â  Â  Â  Â  .loading-spinner {
Â  Â  Â  Â  Â  Â  border: 4px solid rgba(255, 255, 255, 0.3);
Â  Â  Â  Â  Â  Â  border-top: 4px solid #fff;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  width: 20px;
Â  Â  Â  Â  Â  Â  height: 20px;
Â  Â  Â  Â  Â  Â  animation: spin 1s linear infinite;
Â  Â  Â  Â  Â  Â  margin-right: 10px;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .loading-btn {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes spin {
Â  Â  Â  Â  Â  Â  0% { transform: rotate(0deg); }
Â  Â  Â  Â  Â  Â  100% { transform: rotate(360deg); }
Â  Â  Â  Â  }
Â  Â  Â  Â  .dashboard-link { text-align: right; margin-bottom: 20px; }
Â  Â  Â  Â  @media (min-width: 768px) {
Â  Â  Â  Â  Â  Â  .form-container { max-width: 600px; padding: 30px; margin: 40px auto; border-radius: 12px; }
Â  Â  Â  Â  Â  Â  h2 { font-size: 2rem; }
Â  Â  Â  Â  Â  Â  label { font-size: 1rem; }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

<div class="form-container">
Â  Â  <div class="dashboard-link">
Â  Â  Â  Â  <a href="dashboard.html" target="_blank" style="color: #007bff; text-decoration: none; font-size: 0.9rem;">
Â  Â  Â  Â  Â  Â  ğŸ“Š ë³´ê³  í˜„í™© ëŒ€ì‹œë³´ë“œ ë³´ê¸°
Â  Â  Â  Â  </a>
Â  Â  </div>
Â  Â  <h2>ë¹„ìƒëŒ€í”¼ ì¸ì› ë³´ê³ </h2>
Â  Â  <form id="reportForm">
Â  Â  Â  Â  <label for="reporter">ë³´ê³ ì ì„±ëª…</label>
Â  Â  Â  Â  <input type="text" id="reporter" placeholder="ì„±ëª… ì…ë ¥" required>
Â  Â  Â  Â  <label for="contact">ì—°ë½ì²˜</label>
Â  Â  Â  Â  <input type="tel" id="contact" placeholder="010-1234-5678" required>
Â  Â  Â  Â  <div class="note-tip">ìˆ«ìë§Œ ì…ë ¥í•´ ì£¼ì„¸ìš”. í•˜ì´í”ˆ(-)ì€ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤.</div>
Â  Â  Â  Â  <label for="division">ì†Œì† ì‚¬ì—…ë¶€/ì‹¤</label>
Â  Â  Â  Â  <select id="division" required>
Â  Â  Â  Â  Â  Â  <option value="">-- ì„ íƒ --</option>
Â  Â  Â  Â  Â  Â  <option value="SYSTEMì‚¬ì—…ë¶€">SYSTEMì‚¬ì—…ë¶€</option>
Â  Â  Â  Â  Â  Â  <option value="INFRAì‚¬ì—…ë¶€">INFRAì‚¬ì—…ë¶€</option>
Â  Â  Â  Â  Â  Â  <option value="ê²½ì˜ì§€ì›ì‹¤">ê²½ì˜ì§€ì›ì‹¤</option>
Â  Â  Â  Â  Â  Â  <option value="ì§ì†(ì—°êµ¬ì†Œ, êµ¬ë§¤íŒ€, ì•ˆì „í™˜ê²½, ê¸€ë¡œë²ŒTF)">ì§ì†(ì—°êµ¬ì†Œ, êµ¬ë§¤íŒ€, ì•ˆì „í™˜ê²½, ê¸€ë¡œë²ŒTF)</option>
Â  Â  Â  Â  Â  Â  <option value="í˜‘ë ¥ì‚¬">í˜‘ë ¥ì‚¬</option>
Â  Â  Â  Â  Â  Â  <option value="ê¸°íƒ€">ê¸°íƒ€</option>
Â  Â  Â  Â  </select>
Â  Â  Â  Â  <label for="department">ì„¸ë¶€ íŒ€/ë¶€ì„œëª…</label>
Â  Â  Â  Â  <select id="department" required></select>
Â  Â  Â  Â  <input type="text" id="department-text" placeholder="ë¶€ì„œëª… ì…ë ¥" style="display:none;">
Â  Â  Â  Â  <div id="commonDeptNote" class="note-tip" style="display:none; color: #007bff; text-align: left;">* ì†Œì† ì‚¬ì—…ë¶€ì˜ ì†Œìˆ˜ íŒ€ì€ 'ì‚¬ì—…ë¶€ ê³µí†µ'ìœ¼ë¡œ ë³´ê³  ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
Â  Â  Â  Â  <div class="checkbox-group">
Â  Â  Â  Â  Â  Â  <input type="checkbox" id="hasVisitor">
Â  Â  Â  Â  Â  Â  <label for="hasVisitor" style="font-weight:normal; margin:0;">ë‚´ë°©ê° í¬í•¨ ì—¬ë¶€</label>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <label for="visitorTotal" id="visitorLabel" style="display:none;">ë‚´ë°©ê° ì¸ì›</label>
Â  Â  Â  Â  <input type="number" id="visitorTotal" min="0" placeholder="0" style="display:none;">
Â  Â  Â  Â  <label for="total">ëŒ€í”¼ëŒ€ìƒì ìˆ˜</label>
Â  Â  Â  Â  <input type="number" id="total" min="0" required>
Â  Â  Â  Â  <div class="note-tip">í•´ë‹¹ ë¶€ì„œì˜ ì´ ì¸ì› ìˆ˜</div>
Â  Â  Â  Â  <label for="evacuated">ëŒ€í”¼ì™„ë£Œ ì¸ì› ìˆ˜</label>
Â  Â  Â  Â  <input type="number" id="evacuated" min="0" required>
Â  Â  Â  Â  <div class="note-tip">ëŒ€í”¼ ì¥ì†Œì— ë„ì°©í•œ ì¸ì› ìˆ˜</div>
Â  Â  Â  Â  <label for="note">íŠ¹ì´ì‚¬í•­</label>
Â  Â  Â  Â  <textarea id="note" rows="3" placeholder="íŠ¹ì´ì‚¬í•­ ì…ë ¥ (ì˜ˆ: ë¶€ìƒì ë°œìƒ, ì”ë¥˜ì ë°œìƒ ì‚¬ìœ  ë“±)"></textarea>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="checkbox-group" style="margin-top: 20px;">
Â  Â  Â  Â  Â  Â  <input type="checkbox" id="privacyConsent" required>
Â  Â  Â  Â  Â  Â  <label for="privacyConsent" style="font-weight:normal; margin:0; font-size:0.9rem;">
Â  Â  Â  Â  Â  Â  Â  Â  ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.
Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <button type="submit" id="submitBtn">
Â  Â  Â  Â  Â  Â  <div class="loading-spinner"></div>
Â  Â  Â  Â  Â  Â  ë³´ê³  ì œì¶œ
Â  Â  Â  Â  </button>
Â  Â  </form>
</div>

<script>
Â  Â  // ì´ URLì„ ì•±ìŠ¤í¬ë¦½íŠ¸ ë°°í¬ URLë¡œ ë³€ê²½í•˜ì„¸ìš”.
Â  Â  const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbysncTbZ4pE6A4o4acDRaJ3SXXzWE5SwmkIUd3-Vzc-TB7tvNTomUs6fSpEYFLLiWks/exec";
Â  Â Â 
Â  Â  const reportForm = document.getElementById("reportForm");
Â  Â  const contactInput = document.getElementById("contact");
Â  Â  const divisionSelect = document.getElementById("division");
Â  Â  const departmentSelect = document.getElementById("department");
Â  Â  const departmentText = document.getElementById("department-text");
Â  Â  const commonDeptNote = document.getElementById("commonDeptNote");
Â  Â  const hasVisitorCheckbox = document.getElementById("hasVisitor");
Â  Â  const visitorLabel = document.getElementById("visitorLabel");
Â  Â  const visitorTotalInput = document.getElementById("visitorTotal");
Â  Â  const consentCheckbox = document.getElementById("privacyConsent");
Â  Â  const submitBtn = document.getElementById("submitBtn");
Â  Â  const loadingSpinner = submitBtn.querySelector(".loading-spinner");
Â  Â Â 
Â  Â  const departments = {
Â  Â  Â  Â  'SYSTEMì‚¬ì—…ë¶€': ['ì‚¬ì—…ë¶€ ê³µí†µ', 'ì˜ì—…íŒ€', 'CSíŒ€', 'ì œì¡°íŒ€', 'ìƒì‚°ê¸°ìˆ íŒ€', 'í’ˆì§ˆG'],
Â  Â  Â  Â  'INFRAì‚¬ì—…ë¶€': ['ì‚¬ì—…ë¶€ ê³µí†µ', 'ENCì‚¬ì—…íŒ€', 'EPCì‚¬ì—…íŒ€'],
Â  Â  Â  Â  'ê²½ì˜ì§€ì›ì‹¤': ['ì‚¬ì—…ë¶€ ê³µí†µ', 'ì¬ë¬´íŒ€', 'ì¸ì‚¬íŒ€', 'ì •ë³´ì „ëµíŒ€', 'ê¸°íšG', 'ì¤€ë²•ê²½ì˜G'],
Â  Â  Â  Â  'ì§ì†(ì—°êµ¬ì†Œ, êµ¬ë§¤íŒ€, ì•ˆì „í™˜ê²½, ê¸€ë¡œë²ŒTF)': ['ì‚¬ì—…ë¶€ ê³µí†µ', 'ì—°êµ¬ì†Œ', 'êµ¬ë§¤íŒ€', 'ì•ˆì „í™˜ê²½íŒ€', 'ê¸€ë¡œë²ŒTF'],
Â  Â  Â  Â  'í˜‘ë ¥ì‚¬': [],
Â  Â  Â  Â  'ê¸°íƒ€': []
Â  Â  };

Â  Â  hasVisitorCheckbox.addEventListener('change', function() {
Â  Â  Â  Â  if (this.checked) {
Â  Â  Â  Â  Â  Â  visitorLabel.style.display = 'block';
Â  Â  Â  Â  Â  Â  visitorTotalInput.style.display = 'block';
Â  Â  Â  Â  Â  Â  visitorTotalInput.setAttribute('required', 'required');
Â  Â  Â  Â  Â  Â  visitorTotalInput.value = '';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  visitorLabel.style.display = 'none';
Â  Â  Â  Â  Â  Â  visitorTotalInput.style.display = 'none';
Â  Â  Â  Â  Â  Â  visitorTotalInput.removeAttribute('required');
Â  Â  Â  Â  Â  Â  visitorTotalInput.value = '0';
Â  Â  Â  Â  }
Â  Â  });

Â  Â  divisionSelect.addEventListener('change', function() {
Â  Â  Â  Â  const selectedDivision = this.value;
Â  Â  Â  Â  const subDepartments = departments[selectedDivision] || [];
Â  Â  Â  Â  
Â  Â  Â  Â  departmentSelect.innerHTML = '';
Â  Â  Â  Â  
Â  Â  Â  Â  if (selectedDivision === 'í˜‘ë ¥ì‚¬' || selectedDivision === 'ê¸°íƒ€') {
Â  Â  Â  Â  Â  Â  departmentSelect.style.display = 'none';
Â  Â  Â  Â  Â  Â  departmentText.style.display = 'block';
Â  Â  Â  Â  Â  Â  commonDeptNote.style.display = 'none';
Â  Â  Â  Â  Â  Â  departmentText.setAttribute('required', 'required');
Â  Â  Â  Â  Â  Â  departmentSelect.removeAttribute('required');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  departmentSelect.style.display = 'block';
Â  Â  Â  Â  Â  Â  departmentText.style.display = 'none';
Â  Â  Â  Â  Â  Â  commonDeptNote.style.display = 'block';
Â  Â  Â  Â  Â  Â  departmentText.removeAttribute('required');
Â  Â  Â  Â  Â  Â  departmentSelect.setAttribute('required', 'required');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const defaultOption = document.createElement('option');
Â  Â  Â  Â  Â  Â  defaultOption.text = '-- ì„ íƒ --';
Â  Â  Â  Â  Â  Â  defaultOption.value = '';
Â  Â  Â  Â  Â  Â  departmentSelect.appendChild(defaultOption);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  subDepartments.forEach(dept => {
Â  Â  Â  Â  Â  Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  Â  Â  Â  Â  Â  option.value = dept;
Â  Â  Â  Â  Â  Â  Â  Â  option.text = dept;
Â  Â  Â  Â  Â  Â  Â  Â  departmentSelect.appendChild(option);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  });

Â  Â  contactInput.addEventListener("input", function(e) {
Â  Â  Â  Â  const value = e.target.value.replace(/\D/g, "");
Â  Â  Â  Â  const originalLength = value.length;
Â  Â  Â  Â  let formattedValue = "";

Â  Â  Â  Â  if (originalLength > 0) {
Â  Â  Â  Â  Â  Â  if (value.startsWith("02")) {
Â  Â  Â  Â  Â  Â  Â  Â  if (originalLength > 2) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formattedValue += value.substring(0, 2) + "-";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (originalLength > 6) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formattedValue += value.substring(2, 6) + "-";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formattedValue += value.substring(6, 10);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formattedValue += value.substring(2, 6);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formattedValue = value;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  if (originalLength > 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formattedValue += value.substring(0, 3) + "-";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (originalLength > 7) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formattedValue += value.substring(3, 7) + "-";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formattedValue += value.substring(7, 11);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formattedValue += value.substring(3, 7);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formattedValue = value;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  e.target.value = formattedValue;
Â  Â  });

Â  Â  reportForm.addEventListener("submit", async function(e){
Â  Â  Â  Â  e.preventDefault();

Â  Â  Â  Â  // ê°œì¸ì •ë³´ ë™ì˜ ì—¬ë¶€ í™•ì¸
Â  Â  Â  Â  if (!consentCheckbox.checked) {
Â  Â  Â  Â  Â  Â  alert("ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•´ì•¼ ë³´ê³ ì„œë¥¼ ì œì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const reporter = document.getElementById("reporter").value;
Â  Â  Â  Â  const contact = document.getElementById("contact").value;
Â  Â  Â  Â  const division = divisionSelect.value;
Â  Â  Â  Â  const department = (division === 'í˜‘ë ¥ì‚¬' || division === 'ê¸°íƒ€') ? departmentText.value : departmentSelect.value;
Â  Â  Â  Â  const total = parseInt(document.getElementById("total").value);
Â  Â  Â  Â  const evacuated = parseInt(document.getElementById("evacuated").value);
Â  Â  Â  Â  const note = document.getElementById("note").value;
Â  Â  Â  Â  
Â  Â  Â  Â  const hasVisitor = hasVisitorCheckbox.checked;
Â  Â  Â  Â  const visitorTotal = hasVisitor ? parseInt(visitorTotalInput.value) : 0;
Â  Â  Â  Â  
Â  Â  Â  Â  if (!reporter || !contact || !division || !department || isNaN(total) || isNaN(evacuated)) {
Â  Â  Â  Â  Â  Â  alert("ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  if (hasVisitor && isNaN(visitorTotal)) {
Â  Â  Â  Â  Â  Â  alert("ë‚´ë°©ê° ì¸ì›ì„ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const remaining = total - evacuated;
Â  Â  Â  Â  
Â  Â  Â  Â  if (remaining < 0) {
Â  Â  Â  Â  Â  Â  alert("ëŒ€í”¼ì™„ë£Œ ì¸ì›ì´ ëŒ€í”¼ëŒ€ìƒìë³´ë‹¤ ë§ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const data = {reporter, contact, division, department, total, evacuated, remaining, note, hasVisitor, visitorTotal};
Â  Â  Â  Â  
Â  Â  Â  Â  submitBtn.disabled = true;
Â  Â  Â  Â  submitBtn.classList.add('loading-btn');
Â  Â  Â  Â  loadingSpinner.style.display = 'block';
Â  Â  Â  Â  submitBtn.childNodes[1].nodeValue = ' ì œì¶œ ì¤‘...';

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const res = await fetch(WEBAPP_URL, {
Â  Â  Â  Â  Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  Â  Â  Â  Â  cache: "no-cache",
Â  Â  Â  Â  Â  Â  Â  Â  headers: { "Content-Type": "text/plain;charset=utf-8" },
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(data)
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  const result = await res.json();

Â  Â  Â  Â  Â  Â  if (result.result === "success") {
Â  Â  Â  Â  Â  Â  Â  Â  alert("ë³´ê³ ê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.");
Â  Â  Â  Â  Â  Â  Â  Â  reportForm.reset();
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  alert("ì œì¶œ ì‹¤íŒ¨: " + (result.error || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"));
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  } catch(err) {
Â  Â  Â  Â  Â  Â  console.error(err);
Â  Â  Â  Â  Â  Â  alert("ì˜¤ë¥˜ ë°œìƒ: ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.");
Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  submitBtn.disabled = false;
Â  Â  Â  Â  Â  Â  submitBtn.classList.remove('loading-btn');
Â  Â  Â  Â  Â  Â  loadingSpinner.style.display = 'none';
Â  Â  Â  Â  Â  Â  submitBtn.childNodes[1].nodeValue = 'ë³´ê³  ì œì¶œ';
Â  Â  Â  Â  }
Â  Â  });
</script>

</body>
</html>
